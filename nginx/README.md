# Nginx

Nginxï¼ˆå‘éŸ³ä¸ºâ€œengine Xâ€ï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„ã€é«˜æ€§èƒ½çš„WebæœåŠ¡å™¨è½¯ä»¶ï¼Œä¹Ÿå¯ä»¥ç”¨ä½œåå‘ä»£ç†æœåŠ¡å™¨ã€è´Ÿè½½å‡è¡¡å™¨ã€HTTPç¼“å­˜ä»¥åŠé€šç”¨çš„ä»£ç†æœåŠ¡å™¨ã€‚Nginxåœ¨å¤„ç†å¹¶å‘è¿æ¥å’Œé«˜æµé‡è´Ÿè½½æ–¹é¢è¡¨ç°å‡ºè‰²ï¼Œå› æ­¤åœ¨æ„å»ºç¨³å®šã€é«˜æ•ˆçš„ç½‘ç»œåº”ç”¨ç¨‹åºå’Œç½‘ç«™æ—¶éå¸¸å—æ¬¢è¿ã€‚<br>

å®‰è£…å’Œä½¿ç”¨Nginxï¼ˆEngine-Xï¼‰åœ¨Ubuntu 18.04.6ä¸Šç›¸å¯¹æ¯”è¾ƒç®€å•ã€‚æœ¬æ–‡è®²è§£å®‰è£…ã€Nginxçš„åŸºæœ¬ä½¿ç”¨å’Œå¸¸è§ç”¨æ³•ï¼š<br>

- [Nginx](#nginx)
  - [æ£€æŸ¥NginxæœåŠ¡çŠ¶æ€:](#æ£€æŸ¥nginxæœåŠ¡çŠ¶æ€)
  - [å®‰è£…Nginxå¹¶å¯åŠ¨:](#å®‰è£…nginxå¹¶å¯åŠ¨)
    - [Nginxæ— æ³•å¯åŠ¨çš„è§£å†³æ–¹æ¡ˆ:](#nginxæ— æ³•å¯åŠ¨çš„è§£å†³æ–¹æ¡ˆ)
    - [`systemctl start nginx` å’Œ `service nginx start` çš„åŒºåˆ«:](#systemctl-start-nginx-å’Œ-service-nginx-start-çš„åŒºåˆ«)
  - [åœæ­¢NginxæœåŠ¡:](#åœæ­¢nginxæœåŠ¡)
  - [è®©Nginxé‡æ–°åŠ è½½é…ç½®:](#è®©nginxé‡æ–°åŠ è½½é…ç½®)
  - [Nginxé…ç½®é¡¹çš„é€‰æ‹©:](#nginxé…ç½®é¡¹çš„é€‰æ‹©)
    - [æƒ…å†µæè¿°:](#æƒ…å†µæè¿°)
    - [å…·ä½“è§£é‡Š:](#å…·ä½“è§£é‡Š)
  - [ç¤ºä¾‹:é€šè¿‡åŸŸåè®¿é—®ä¸ªäººæœåŠ¡:](#ç¤ºä¾‹é€šè¿‡åŸŸåè®¿é—®ä¸ªäººæœåŠ¡)
    - [å‰æ:](#å‰æ)
    - [1. **åˆ›å»ºæˆ–ä¿®æ”¹é…ç½®æ–‡ä»¶**ï¼š](#1-åˆ›å»ºæˆ–ä¿®æ”¹é…ç½®æ–‡ä»¶)
    - [2. **æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•å¹¶é‡è½½Nginxé…ç½®**ï¼š](#2-æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•å¹¶é‡è½½nginxé…ç½®)
    - [3. **éªŒè¯**:](#3-éªŒè¯)
    - [æ‹“å±•: `/chat`ç›®å½•çš„ä»£ç†](#æ‹“å±•-chatç›®å½•çš„ä»£ç†)
  - [å‰ç«¯distæ–‡ä»¶åˆ©ç”¨nginxèµ·æœåŠ¡:](#å‰ç«¯distæ–‡ä»¶åˆ©ç”¨nginxèµ·æœåŠ¡)
      - [å…¶ä»–æ³¨æ„äº‹é¡¹](#å…¶ä»–æ³¨æ„äº‹é¡¹)
      - [å¦‚æœæœåŠ¡è¦è¿ç§»ï¼Œå‰ç«¯distæ–‡ä»¶è¦å¦‚ä½•å¤„ç†:](#å¦‚æœæœåŠ¡è¦è¿ç§»å‰ç«¯distæ–‡ä»¶è¦å¦‚ä½•å¤„ç†)
  - [Nginxçš„åŸºæœ¬ä½¿ç”¨ï¼š](#nginxçš„åŸºæœ¬ä½¿ç”¨)
  - [ç½‘å€çš„æ‰¹é‡æ˜ å°„ï¼š](#ç½‘å€çš„æ‰¹é‡æ˜ å°„)


## æ£€æŸ¥NginxæœåŠ¡çŠ¶æ€:

å®‰è£…Nginxå‰ï¼Œè¦å…ˆæ£€æŸ¥æœåŠ¡å™¨ä¸Šæ˜¯å¦å·²å®‰è£…äº†Nginxã€‚ä¸è¦å› ä¸ºè‡ªå·±çš„ç¼˜æ•…ï¼Œå½±å“å…¶ä»–äººçš„æœåŠ¡ã€‚æ£€æŸ¥NginxæœåŠ¡çŠ¶æ€çš„æŒ‡ä»¤å¦‚ä¸‹:<br>

```bash
sudo systemctl status nginx
```

ç»ˆç«¯æ˜¾ç¤ºå¦‚ä¸‹:<br>

```log
(base) root@iZ2zea5v77oawjy2qz7c20Z:/etc# sudo systemctl status nginx
Unit nginx.service could not be found.
(base) root@iZ2zea5v77oawjy2qz7c20Z:/etc#
```

å¦‚æœNginxå·²å®‰è£…å¹¶è¿è¡Œï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹è¾“å‡º:<br>

```log
â— nginx.service - A high performance web server and a reverse proxy server
     Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)
     Active: active (running) since ...
```


## å®‰è£…Nginxå¹¶å¯åŠ¨:

1. æ‰“å¼€ç»ˆç«¯ã€‚

2. æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ï¼š

```bash
sudo apt update
```

æ³¨æ„âš ï¸âš ï¸âš ï¸ï¼šæ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨æ˜¯è®©ç³»ç»Ÿè·å–å„ç§åº“çš„ä¿¡æ¯ï¼Œå¹¶ä¸ä¼šå‡çº§æˆ–é™ä½ä¸ªäººç¯å¢ƒä¸­çš„åº“ç‰ˆæœ¬ã€‚<br>

3. å®‰è£…Nginx:

```bash
sudo apt install nginx
```

4. å®‰è£…å®Œæˆåï¼ŒNginxå°†ä¼šè‡ªåŠ¨å¯åŠ¨ã€‚ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥Nginxçš„è¿è¡ŒçŠ¶æ€ï¼š

```bash
sudo systemctl status nginx
```

### Nginxæ— æ³•å¯åŠ¨çš„è§£å†³æ–¹æ¡ˆ:

å¦‚æœä¸Šè¿°æŒ‡ä»¤ä½ æ— æ³•ä½¿ç”¨ï¼ŒNginx æ²¡æœ‰æ­£å¸¸å¯åŠ¨ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨ä¸‹åˆ—æŒ‡ä»¤å¯åŠ¨Nginxï¼š<br>

```bash
sudo systemctl start nginx
```

æˆ–è€…ä½¿ç”¨ï¼š<br>

```bash
sudo service nginx start
```

### `systemctl start nginx` å’Œ `service nginx start` çš„åŒºåˆ«:

`sudo systemctl start nginx` å’Œ `sudo service nginx start` è¿™ä¸¤ä¸ªå‘½ä»¤å®é™…ä¸Šéƒ½æ˜¯ç”¨æ¥å¯åŠ¨ Nginx æœåŠ¡çš„ï¼Œä½†å®ƒä»¬ä¹‹é—´å­˜åœ¨ä¸€äº›åŒºåˆ«ï¼Œä¸»è¦æ˜¯å› ä¸ºä¸åŒçš„æœåŠ¡ç®¡ç†ç³»ç»Ÿã€‚<br>

`sudo systemctl start nginx` æ˜¯ä½¿ç”¨ `Systemd` ç³»ç»Ÿç®¡ç†å·¥å…·æ¥æ§åˆ¶æœåŠ¡çš„å‘½ä»¤ï¼Œåœ¨ç°ä»£çš„ `Linux` å‘è¡Œç‰ˆä¸­ï¼Œ`Systemd` æ˜¯å¸¸è§çš„ `init` ç³»ç»Ÿï¼Œç”¨äºç®¡ç†ç³»ç»Ÿè¿›ç¨‹å’ŒæœåŠ¡ã€‚<br>

`sudo service nginx start` æ˜¯ä½¿ç”¨ `System V (SysV) init` ç³»ç»Ÿçš„æœåŠ¡ç®¡ç†å‘½ä»¤ã€‚`SysV init` ç³»ç»Ÿæ˜¯â˜•ï¸â˜•ï¸â˜•ï¸æ—§å¼çš„ `init` ç³»ç»Ÿï¼Œç”¨äºåœ¨ `Linux` å‘è¡Œç‰ˆä¸­ç®¡ç†ç³»ç»ŸæœåŠ¡ï¼Œä½†åœ¨ç°ä»£ç³»ç»Ÿä¸­é€æ¸è¢« `Systemd` å–ä»£ã€‚<br>

`service` å‘½ä»¤æä¾›äº†ä¸€ç§ç®€åŒ–çš„æ¥å£æ¥å¯åŠ¨ã€åœæ­¢å’Œç®¡ç†æœåŠ¡ï¼Œç›¸å¯¹æ¥è¯´ `systemctl` å‘½ä»¤æä¾›äº†æ›´å¤šçš„åŠŸèƒ½å’Œçµæ´»æ€§ã€‚<br>


## åœæ­¢NginxæœåŠ¡: 

å¦‚æœæƒ³è¦åœæ­¢NginxæœåŠ¡å¯ä»¥ä½¿ç”¨ä¸‹åˆ—æŒ‡ä»¤:<br>

```bash
sudo systemctl stop nginx
```

æˆ–è€…ä½¿ç”¨ï¼š<br>

```bash
sudo service nginx stop
```


## è®©Nginxé‡æ–°åŠ è½½é…ç½®:

ğŸš¨é‡æ–°åŠ è½½é…ç½®å‰éœ€è¦å…ˆæ£€æŸ¥ä½ çš„é…ç½®è¯­æ³•æ˜¯å¦æ­£ç¡®:

```bash
sudo nginx -t
```

å¦‚æœé…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰è¯­æ³•é”™è¯¯ï¼Œä½ å°†ä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹å†…å®¹çš„è¾“å‡ºï¼š

```bash
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
```

å¦‚æœå­˜åœ¨è¯­æ³•é”™è¯¯ï¼Œå®ƒä»¬ä¼šè¢«æ˜¾ç¤ºå‡ºæ¥ï¼Œä½ éœ€è¦æ ¹æ®é”™è¯¯ä¿¡æ¯æ¥ä¿®å¤é…ç½®æ–‡ä»¶ã€‚

ğŸ”¥å¦‚æœé…ç½®æ–‡ä»¶è¯­æ³•æ²¡æœ‰é—®é¢˜ï¼Œé‡æ–°åŠ è½½Nginxé…ç½®ï¼Œä½¿æ›´æ”¹ç”Ÿæ•ˆå³å¯:

```bash
sudo systemctl reload nginx
```

ä¸Šé¢çš„æŒ‡ä»¤ç”¨äºä¸å…³é—­ Nginx çš„æƒ…å†µä½¿ä¿®æ”¹åçš„é…ç½®æ–‡ä»¶ç”Ÿæ•ˆã€‚å¦‚æœä½ çš„ Nginx æ²¡æœ‰è¿è¡Œï¼Œç›´æ¥å¯åŠ¨å®ƒç­‰äºç›¸åŒçš„æ•ˆæœ:

```bash
sudo systemctl start nginx
```


## Nginxé…ç½®é¡¹çš„é€‰æ‹©:

### æƒ…å†µæè¿°:

æœ‰äº›äººè¯´ä¿®æ”¹nginxé…ç½®éœ€è¦ä¿®æ”¹ `/etc/nginx/nginx.conf`ï¼Œæœ‰äº›äººè¯´è¦è¦åœ¨ `/etc/nginx/conf.d/` æ·»åŠ è‡ªå·±çš„é…ç½®ã€‚ä¸åŒçš„é€‰æ‹©ï¼Œæ€»ä¼šè®©äººå¾ˆæ‡µã€‚é‚£è¿™ä¸¤ä¸ªäººè°è¯´çš„å¯¹å‘¢ï¼Ÿæ˜¯æœ‰ä¸åŒåœºæ™¯çš„ä½¿ç”¨é™åˆ¶å—ï¼Ÿ

### å…·ä½“è§£é‡Š:

ä½ çš„ç–‘æƒ‘å¾ˆæ­£å¸¸ï¼Œå› ä¸ºNginxçš„é…ç½®æ–‡ä»¶æœ‰ä¸åŒçš„å±‚çº§å’Œç”¨é€”ï¼Œå…·ä½“ä½¿ç”¨å“ªä¸ªæ–‡ä»¶ä¿®æ”¹é…ç½®å–å†³äºä½ çš„éœ€æ±‚å’Œåœºæ™¯ã€‚ä¸‹é¢æ˜¯å¯¹è¿™å‡ ç§æ–‡ä»¶çš„è§£é‡ŠåŠå…¶ä½¿ç”¨åœºæ™¯:

1. **`/etc/nginx/nginx.conf`**:

- è¿™æ˜¯Nginxçš„ä¸»é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«å…¨å±€é…ç½®å’Œä¸€äº›é»˜è®¤é…ç½®ã€‚ä¸€èˆ¬ç”¨äºå®šä¹‰å…¨å±€è®¾ç½®ï¼Œå¦‚ç”¨æˆ·æƒé™ã€å·¥ä½œè¿›ç¨‹æ•°é‡ã€æ—¥å¿—è·¯å¾„ç­‰ã€‚

- é€‚ç”¨åœºæ™¯ï¼šå½“éœ€è¦ä¿®æ”¹å…¨å±€è®¾ç½®æˆ–Nginxçš„æ ¸å¿ƒé…ç½®æ—¶ã€‚

2. **`/etc/nginx/conf.d/`**:

- è¿™ä¸ªç›®å½•é€šå¸¸ç”¨äºå­˜æ”¾é¢å¤–çš„é…ç½®æ–‡ä»¶ï¼Œé»˜è®¤Nginxä¼šåŠ è½½è¿™ä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰é…ç½®æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶é€šå¸¸ç”¨äºå®šä¹‰ç‰¹å®šçš„è™šæ‹Ÿä¸»æœºé…ç½®æˆ–å…¶ä»–æ¨¡å—çš„é…ç½®ã€‚

- é€‚ç”¨åœºæ™¯ï¼šå½“ä½ éœ€è¦ä¸ºä¸åŒçš„ç½‘ç«™ï¼ˆè™šæ‹Ÿä¸»æœºï¼‰æˆ–è€…ç‰¹å®šæœåŠ¡æ¨¡å—å•ç‹¬é…ç½®æ—¶ï¼Œå¯ä»¥åœ¨è¿™ä¸ªç›®å½•ä¸‹åˆ›å»ºæ–°çš„é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸ä»¥`.conf`ç»“å°¾ï¼‰ã€‚

3. **å…¶ä»–é…ç½®æ–‡ä»¶**:

- åœ¨Nginxçš„ä¸»é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨`include`æŒ‡ä»¤å¼•å…¥å…¶ä»–é…ç½®æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨`nginx.conf`ä¸­åŒ…å«`sites-available`æˆ–`sites-enabled`ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ã€‚è¿™äº›ç›®å½•é€šå¸¸ç”¨äºå­˜æ”¾è™šæ‹Ÿä¸»æœºé…ç½®ã€‚

- é€‚ç”¨åœºæ™¯ï¼šæ ¹æ®ä¸ªäººæˆ–ç»„ç»‡çš„ä¹ æƒ¯ï¼Œé…ç½®æ–‡ä»¶å¯ä»¥æ”¾åœ¨ä¸åŒçš„ç›®å½•ä¸­ï¼Œä»¥ä¾¿äºç®¡ç†å’Œç»´æŠ¤ã€‚ä¾‹å¦‚ï¼Œåœ¨Debian/Ubuntuç³»ç»Ÿä¸­ï¼Œé€šå¸¸ä½¿ç”¨`/etc/nginx/sites-available/`å’Œ`/etc/nginx/sites-enabled/`ç›®å½•ã€‚

> `/etc/nginx/sites-enabled/`ç”¨äºé…ç½®å¿«æ·æ–¹å¼ã€‚


## ç¤ºä¾‹:é€šè¿‡åŸŸåè®¿é—®ä¸ªäººæœåŠ¡:

### å‰æ:

- åŸŸåå·²ç”³è¯·(peilongchencc.cn)
- å·²å‡†å¤‡å¥½åç«¯ç¨‹åºï¼Œç¨‹åºæ¥å£ä¸º`http://localhost:7860`å’Œ`http://localhost:7860/chat`ã€‚
- Nginxè¿™ä¸ªåŸŸåéœ€è¦å’Œ`http://localhost:7860`ã€`http://localhost:7860/chat`ç»‘å®šã€‚

### 1. **åˆ›å»ºæˆ–ä¿®æ”¹é…ç½®æ–‡ä»¶**ï¼š

åœ¨ `/etc/nginx/conf.d/` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„é…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚ `peilongchencc.cn.conf`ï¼š<br>

> ä¹Ÿå¯ä½¿ç”¨`/etc/nginx/sites-available/`ã€‚

```bash
sudo vim /etc/nginx/conf.d/peilongchencc.cn.conf
```

ç„¶ååœ¨æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®:

```conf
server {
    listen 80;
    server_name peilongchencc.cn;

    location / {
        proxy_pass http://localhost:7860;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

è¿™ä¸ªé…ç½®å°†æŠŠæ‰€æœ‰å¯¹ `peilongchencc.cn` çš„è¯·æ±‚ä»£ç†åˆ° `http://localhost:7860`ã€‚

### 2. **æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•å¹¶é‡è½½Nginxé…ç½®**ï¼š

åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥æ£€æŸ¥ Nginx é…ç½®æ–‡ä»¶çš„è¯­æ³•ã€‚è¯­æ³•æ£€æŸ¥é€šè¿‡åï¼Œé‡è½½ Nginx é…ç½®ä»¥åº”ç”¨æ–°çš„æ›´æ”¹:

```bash
# æ£€æŸ¥Nginxé…ç½®è¯­æ³•æ­£ç¡®æ€§
sudo nginx -t
# é‡è½½Nginxé…ç½®(éé‡å¯æœåŠ¡)
sudo systemctl reload nginx
```

### 3. **éªŒè¯**:

é…ç½®å®Œæˆåï¼Œä½ å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è®¿é—® `http://peilongchencc.cn`ã€‚Nginx ä¼šå°†è¯·æ±‚ä»£ç†åˆ° `http://localhost:7860`ã€‚

### æ‹“å±•: `/chat`ç›®å½•çš„ä»£ç†

å®Œæˆä¸Šè¿°Nginxé…ç½®åï¼Œè®¿é—® `http://peilongchencc.cn/chat` ä¼šè¢«ä»£ç†åˆ° `http://localhost:7860/chat`ã€‚

åŸå› :

`location /` è¡¨ç¤ºåŒ¹é…æ‰€æœ‰ä»¥ `/` å¼€å¤´çš„è¯·æ±‚è·¯å¾„ã€‚å› æ­¤ï¼Œæ— è®ºæ˜¯è®¿é—® `http://peilongchencc.cn` è¿˜æ˜¯ `http://peilongchencc.cn/chat`ï¼ŒNginx éƒ½ä¼šå°†è¯·æ±‚ä»£ç†åˆ° http://localhost:7860ï¼Œå¹¶ä¸”ä¼šå°†è¯·æ±‚çš„å®Œæ•´è·¯å¾„ï¼ˆä¾‹å¦‚ `/chat`ï¼‰ä¸€å¹¶è½¬å‘åˆ°åç«¯ã€‚


## å‰ç«¯distæ–‡ä»¶åˆ©ç”¨nginxèµ·æœåŠ¡:

å‰ç«¯çš„`dist`æ–‡ä»¶é€šå¸¸æ˜¯å‰ç«¯é¡¹ç›®æ‰“åŒ…åçš„é™æ€èµ„æºæ–‡ä»¶ï¼Œéœ€è¦é€šè¿‡Nginxè¿›è¡Œæ‰˜ç®¡å’Œè®¿é—®ã€‚ä¸ºæ­¤ï¼Œä½ å¯ä»¥åœ¨Nginxçš„é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ä¸€ä¸ªæœåŠ¡å™¨å—ï¼ˆserver blockï¼‰æ¥å¤„ç†è¿™äº›é™æ€æ–‡ä»¶ã€‚é€šå¸¸ï¼Œè¿™ç±»é…ç½®æ–‡ä»¶ä¼šæ”¾åœ¨`/etc/nginx/conf.d/`ç›®å½•ä¸‹ã€‚<br>

ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„é…ç½®ç¤ºä¾‹ï¼Œå‡è®¾ä½ çš„å‰ç«¯`dist`æ–‡ä»¶ç›®å½•ä½äº`/var/www/mywebsite/dist`ï¼š<br>

1. **åˆ›å»ºæ–°çš„é…ç½®æ–‡ä»¶**ï¼š

åœ¨`/etc/nginx/conf.d/`ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„é…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚`mywebsite.conf`ï¼š<br>

```bash
sudo vim /etc/nginx/conf.d/mywebsite.conf
```

2. **é…ç½®æ–‡ä»¶å†…å®¹**ï¼š

åœ¨æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š<br>

```nginx
server {
    listen       8000;

    root   /data/mywebsite/dist;
    index  index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

è§£é‡Šï¼š<br>

- `listen 8000;`ï¼šç›‘å¬8000ç«¯å£ï¼Œå¤„ç†HTTPè¯·æ±‚ã€‚
- `root   /data/mywebsite/dist;;`ï¼šæŒ‡å®šé™æ€æ–‡ä»¶çš„æ ¹ç›®å½•ã€‚
- `index index.html;`ï¼šæŒ‡å®šé»˜è®¤æ–‡ä»¶ã€‚
- `location /`ï¼šå¤„ç†æ ¹è·¯å¾„è¯·æ±‚ã€‚
    - `try_files $uri $uri/ /index.html;`ï¼šå°è¯•æŒ‰é¡ºåºæŸ¥æ‰¾æ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›`index.html`ï¼Œè¿™å¯¹äºSPAï¼ˆå•é¡µåº”ç”¨ï¼‰éå¸¸é‡è¦ã€‚

3. **æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•å¹¶é‡å¯Nginx**ï¼š

```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶çš„è¯­æ³•æ˜¯å¦æ­£ç¡®
sudo nginx -t
# é‡æ–°åŠ è½½Nginxé…ç½®
sudo systemctl reload nginx
```

#### å…¶ä»–æ³¨æ„äº‹é¡¹

- **HTTPS é…ç½®**ï¼šå¦‚æœä½ éœ€è¦ä½¿ç”¨HTTPSï¼Œè¿˜éœ€è¦é…ç½®SSLè¯ä¹¦ï¼Œå¯ä»¥åœ¨åŒä¸€ä¸ªserverå—ä¸­æ·»åŠ ç›¸åº”çš„é…ç½®ï¼š

```nginx
listen 443 ssl;
ssl_certificate /path/to/your/certificate.crt;
ssl_certificate_key /path/to/your/certificate.key;
```

- **åå‘ä»£ç†**ï¼šå¦‚æœä½ çš„å‰ç«¯éœ€è¦ä¸åç«¯APIé€šä¿¡ï¼Œå¯ä»¥åœ¨åŒä¸€ä¸ªserverå—ä¸­é…ç½®åå‘ä»£ç†ï¼š

```nginx
location /api/ {
    proxy_pass http://backend_server;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
```

#### å¦‚æœæœåŠ¡è¦è¿ç§»ï¼Œå‰ç«¯distæ–‡ä»¶è¦å¦‚ä½•å¤„ç†:

å‡è®¾åŸæ¥å‰ç«¯çš„æ–‡ä»¶(distæ–‡ä»¶)å’Œåç«¯çš„ä»£ç éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ï¼Œå‰ç«¯ä»£ç ä¸­ï¼ˆä¾‹å¦‚ `.js` æˆ– `.html` æ–‡ä»¶ï¼‰é€šè¿‡ `http://8.140.203.xxx:8848/bank_chatbot` è®¿é—®ä½ çš„æœåŠ¡ã€‚<br>

ç°åœ¨ï¼Œé¢†å¯¼è¦æ±‚å‰ç«¯çš„æœåŠ¡éœ€è¦å’Œä½ åç«¯çš„æœåŠ¡éƒ¨ç½²åœ¨åŒä¸€å°æœåŠ¡å™¨ã€‚ä½ éœ€è¦:<br>

1. ä¿®æ”¹IP:

å°†å‰ç«¯ä»£ç ä¸­çš„ `http://8.140.203.xxx:8848/bank_chatbot` ä¿®æ”¹ä¸º `http://localhost:8848/bank_chatbot`ã€‚

2. é…ç½®Nginx:

é…ç½®Nginxçš„æ–¹æ³•å‰é¢å·²ç»è®²è¿‡äº†ï¼Œè¯¦æƒ…å¯å‚è€ƒä¸Šé¢çš„å†…å®¹ã€‚

3. é‡å¯Nginx;

4. æ‰“å¼€ç½‘å€:

åˆ©ç”¨ç½‘å€åŠ åŸŸåçš„æ–¹å¼å³å¯æ‰“å¼€å‰ç«¯ç•Œé¢ï¼Œå¦‚æœ`dist`æ–‡ä»¶ä¸­åŠ äº†è·¯ç”±ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼ä¸‹åˆ—æ–¹å¼æ‰“å¼€ç•Œé¢:<br>

```log
http://8.140.203.xxx:8000/Index
```

> 8101æ˜¯Nginxä¸­å•ç‹¬ç»™å‰ç«¯ç½‘é¡µé…çš„ç«¯å£ã€‚


## Nginxçš„åŸºæœ¬ä½¿ç”¨ï¼š

æ¥ä¸‹æ¥ä»¥**Nginxåå‘ä»£ç†**ä¸ºä¾‹ï¼Œè®²è§£ Flask + Nginx çš„ä½¿ç”¨ï¼š<br>

> å…¶å®æ— è®ºä½ ä½¿ç”¨çš„æ˜¯ Flaskã€Fast-APIã€Sanicæˆ–å…¶ä»–Webåº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œå’Œ `Nginx` ç»“åˆä½¿ç”¨çš„é“ç†æ˜¯ä¸€æ ·çš„ã€‚

1. ç¡®å®šè‡ªå·±çš„è·¯ç”±ã€ç«¯å£ä¿¡æ¯ï¼Œç„¶åå¯åŠ¨è‡ªå·±çš„FlaskæœåŠ¡ï¼š

å‡è®¾ä½ ç¨‹åºå…¥å£çš„ä»£ç å¦‚ä¸‹ï¼Œç«¯å£å·ä¸º7711ï¼Œè®¿é—®çš„URLä¸º `http://localhost:7711/nlp-server/`ï¼š<br>

```python
from flask import Flask, Blueprint

# åˆ›å»ºä¸€ä¸ª Flask åº”ç”¨å®ä¾‹
app = Flask(__name__)

# åˆ›å»ºä¸€ä¸ª Blueprint å¹¶è®¾ç½®å‰ç¼€
nlp_server_blueprint = Blueprint('nlp_server', __name__, url_prefix='/nlp-server')

# åœ¨ Blueprint ä¸­å®šä¹‰è·¯ç”±
@nlp_server_blueprint.route('/')
def hello():
    return 'Hello, NLP Server!'

# æ³¨å†Œ Blueprint åˆ°åº”ç”¨
app.register_blueprint(nlp_server_blueprint)

# è¿è¡Œåº”ç”¨
if __name__ == '__main__':
    app.run(port=7711)
```

2. æ‰“å¼€ Nginx é…ç½®æ–‡ä»¶ï¼Œ

æ ¹æ® Nginx åœ¨ Ubuntu ä¸Šçš„é»˜è®¤ä½ç½®æ‰“å¼€ Nginx é…ç½®æ–‡ä»¶ï¼š<br>

```bash
sudo vim /etc/nginx/nginx.conf
```

3. åœ¨ `http` æ¨¡å—å†…æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š(ç½‘å€çš„æ‰¹é‡æ˜ å°„è¯·çœ‹ä¸‹ä¸€èŠ‚å†…å®¹)

```python
server {
    isten 80;
    server_name localhost;
    
    location /nlp/ {
        proxy_pass http://localhost:7711/nlp-server/;
        }
}
```
è¯¥é…ç½®å°†ç›‘å¬ç«¯å£ `80`ï¼Œå¹¶å°† `/nlp/ans` è·¯å¾„ä»£ç†åˆ° Sanic æœåŠ¡çš„ `localhost:7711/nlp-server/` è·¯å¾„ã€‚æ„æ€å°±æ˜¯ï¼šä½ åœ¨è®¿é—®æ—¶åªéœ€è¦è¾“å…¥ `http://localhost:80/nlp/` å°±ç›¸å½“äºè®¿é—®äº† `http://localhost:7711/nlp-server/`ã€‚<br>
ğŸ˜€ğŸ˜€ğŸ˜€å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒNginx åå‘ä»£ç†å¹¶ä¸ä¼šæ‹–æ…¢ç¨‹åºååº”é€Ÿåº¦ã€‚<br>

4. æ£€æŸ¥é…ç½®è¯­æ³•ï¼š

```bash
sudo nginx -t
```

å¦‚æœé…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰è¯­æ³•é”™è¯¯ï¼Œä½ å°†ä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹å†…å®¹çš„è¾“å‡ºï¼š<br>

```bash
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
```

å¦‚æœå­˜åœ¨è¯­æ³•é”™è¯¯ï¼Œå®ƒä»¬ä¼šè¢«æ˜¾ç¤ºå‡ºæ¥ï¼Œä½ éœ€è¦æ ¹æ®é”™è¯¯ä¿¡æ¯æ¥ä¿®å¤é…ç½®æ–‡ä»¶ã€‚<br>

5. é‡æ–°åŠ è½½Nginxé…ç½®:

å¦‚æœé…ç½®æ–‡ä»¶è¯­æ³•æ²¡æœ‰é—®é¢˜ï¼Œé‡æ–°åŠ è½½Nginxé…ç½®ï¼Œä½¿æ›´æ”¹ç”Ÿæ•ˆå³å¯ï¼š<br>

```bash
sudo systemctl reload nginx
```

ä¸Šé¢çš„æŒ‡ä»¤ç”¨äºä¸å…³é—­ Nginx çš„æƒ…å†µä½¿ä¿®æ”¹åçš„é…ç½®æ–‡ä»¶ç”Ÿæ•ˆã€‚å¦‚æœä½ çš„ Nginx æ²¡æœ‰è¿è¡Œï¼Œç›´æ¥å¯åŠ¨å®ƒç­‰äºç›¸åŒçš„æ•ˆæœï¼š<br>

```bash
sudo systemctl start nginx
```

ç°åœ¨ä½ å°±å¯ä»¥é€šè¿‡ `http://localhost:80/nlp/` è®¿é—®è‡ªå·±çš„æœåŠ¡äº†ï½<br>


## ç½‘å€çš„æ‰¹é‡æ˜ å°„ï¼š

```log
server {
    listen       8082;
    server_name  localhost;
    
    # ä¿®æ”¹ä»¥bp1ä¸ºå‰ç¼€çš„æ‰€æœ‰ç½‘å€çš„æ˜ å°„
    location /nlp/ {
        proxy_pass http://localhost:7711/bp1/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
    # ä¿®æ”¹ä»¥bp2ä¸ºå‰ç¼€çš„æ‰€æœ‰ç½‘å€çš„æ˜ å°„
    location /irm/ {
        proxy_pass http://localhost:7744/bp2/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}                          
```